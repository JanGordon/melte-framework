(()=>{var r={};async function i(){var u=Array.from(document.querySelectorAll("a"));console.log("caching new links...",u);for(let h of u){console.log(h);var n=h;let o=new URL(n.href);if(window.location.origin!=o.origin){console.log("passing this link: not on same origin");continue}await fetch(o).then(function(t){return t.text()}).then(function(t){r[o]=t}).catch(t=>{console.log("Failed to fetch link")}),h.addEventListener("click",async function(t){if(t.preventDefault(),r.hasOwnProperty(n)){let a=new URL(n.href);var d=r[a];let l=Range.prototype.createContextualFragment.bind(document.createRange());var c=document.implementation.createHTMLDocument();c.documentElement.innerHTML=d,console.log("Loading cached page",d),document.body.innerHTML=c.body.innerHTML,console.log(c.head.innerHTML),document.head.querySelectorAll("*:not(script)").forEach(function(e){e.remove()}),c.head.querySelectorAll("*:not(script").forEach(function(e){document.head.appendChild(e)}),history.replaceState({},c.title,n.href),document.body.querySelectorAll("script").forEach(function(e){if(e.src.includes("out.js")){var m=new URL(e.src.slice(0,e.src.indexOf("out.js"))),f=document.createElement("script");e.parentNode.appendChild(f),e.remove(),f.src=m.pathname+"out.js?cachebuster="+new Date().getTime(),console.log(m.pathname+"out.js?cachebuster="+new Date().getTime())}}),i()}else setTimeout(()=>{console.log("Page hasn't been cached, loading...")},1e3),await fetch(o).then(function(a){return a.text()}).then(function(a){r[o]=a;var l=document.implementation.createHTMLDocument();l.documentElement.innerHTML=d,document.body.innerHTML=l.body.innerHTML,history.replaceState({},l.title,n.href),i()}).catch(()=>{console.log("Failed to fetch link")});var s="hello";console.log(s);var s="hello";function g(){}})}}Array(document.querySelectorAll("a")).forEach(function(u,n){});window.addEventListener("popstate",i);i();})();
